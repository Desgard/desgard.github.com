---
layout:     post
title:      "An iOS Launch Advertising View - DGAdLaunchView"
subtitle:   "启动页广告"
date:       2016-05-23 01:01:00
author:     "Desgard_Duan"
header-img: "img/post-bg-miui-ux.jpg"
tags:
    - iOS
    - swift
---

在杭州云梯科技的实习到了最后一周了，自己也在做业务开发的同时整理了下这三个月以来的收获，并整理成一个个片段打包上传至[github](https://github.com/dgytdhy/)保留。在一周以前，由于公司应合作公司的要求，在[口袋题库](https://itunes.apple.com/us/app/kou-dai-ti-ku-kao-yan-kao/id927291424?mt=8)这个产品的Launch页面增加广告，虽然个人平时很反感启动页面的广告，因为这并不符合苹果对于app设计的审美（详见[《APP启动页的价值和审美》](http://www.huxiu.com/article/4235/1.html)一文）。但是商业需要，不能因自己的任性去反对。

在一番google之后，发现实现启动页广告的效果，在`appDelegate.m`中，在`window`属性上增加一层view即可实现效果。具体效果如果`网易新闻`一样。而在广告页面也要保持launch页面的slogan标识的时候，只有我们将其view背景设置成相同即可。在前期工作都处理完成后，说一下广告图片的缓存逻辑：

这里使用`SDWebImage`来管理图片的缓存。我们确定逻辑流程图如下：

<center>
<svg id="drawing" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs" width="694" height="308.875" viewBox="187 193 694 308.875"><defs id="SvgjsDefs1001"><linearGradient id="SvgjsLinearGradient1012" x1="1" y1="0.5" x2="0" y2="0.5000000000000001"><stop id="SvgjsStop1013" stop-opacity="1" stop-color="#e873f2" offset="0"></stop><stop id="SvgjsStop1014" stop-opacity="1" stop-color="#d12be0" offset="1"></stop></linearGradient><linearGradient id="SvgjsLinearGradient1019" x1="1" y1="0.5" x2="0" y2="0.5000000000000001"><stop id="SvgjsStop1020" stop-opacity="1" stop-color="#e873f2" offset="0"></stop><stop id="SvgjsStop1021" stop-opacity="1" stop-color="#d12be0" offset="1"></stop></linearGradient><marker id="SvgjsMarker1026" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1027" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker><linearGradient id="SvgjsLinearGradient1033" x1="1" y1="0.49999999999999994" x2="0" y2="0.5000000000000002"><stop id="SvgjsStop1034" stop-opacity="1" stop-color="#00ff00" offset="0"></stop><stop id="SvgjsStop1035" stop-opacity="1" stop-color="#00b400" offset="1"></stop></linearGradient><marker id="SvgjsMarker1041" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1042" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker><linearGradient id="SvgjsLinearGradient1048" x1="1" y1="0.49999999999999994" x2="0" y2="0.5000000000000002"><stop id="SvgjsStop1049" stop-opacity="1" stop-color="#9dd7ed" offset="0"></stop><stop id="SvgjsStop1050" stop-opacity="1" stop-color="#899dc0" offset="1"></stop></linearGradient><linearGradient id="SvgjsLinearGradient1055" x1="1" y1="0.4999999999999999" x2="0" y2="0.5000000000000004"><stop id="SvgjsStop1056" stop-opacity="1" stop-color="#9dd7ed" offset="0"></stop><stop id="SvgjsStop1057" stop-opacity="1" stop-color="#899dc0" offset="1"></stop></linearGradient><marker id="SvgjsMarker1062" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1063" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker><marker id="SvgjsMarker1069" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1070" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker><linearGradient id="SvgjsLinearGradient1080" x1="1" y1="0.49999999999999983" x2="0" y2="0.5000000000000007"><stop id="SvgjsStop1081" stop-opacity="1" stop-color="#00ff00" offset="0"></stop><stop id="SvgjsStop1082" stop-opacity="1" stop-color="#00b400" offset="1"></stop></linearGradient><marker id="SvgjsMarker1087" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1088" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker><marker id="SvgjsMarker1094" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1095" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker><linearGradient id="SvgjsLinearGradient1101" x1="1" y1="0.5" x2="0" y2="0.5000000000000001"><stop id="SvgjsStop1102" stop-opacity="1" stop-color="#e873f2" offset="0"></stop><stop id="SvgjsStop1103" stop-opacity="1" stop-color="#d12be0" offset="1"></stop></linearGradient><marker id="SvgjsMarker1108" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1109" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker><linearGradient id="SvgjsLinearGradient1119" x1="1" y1="0.5" x2="0" y2="0.5000000000000001"><stop id="SvgjsStop1120" stop-opacity="1" stop-color="#e873f2" offset="0"></stop><stop id="SvgjsStop1121" stop-opacity="1" stop-color="#d12be0" offset="1"></stop></linearGradient><marker id="SvgjsMarker1126" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1127" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker><marker id="SvgjsMarker1133" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1134" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker><marker id="SvgjsMarker1140" markerWidth="16.23606797749979" markerHeight="10.550836550532098" refX="-1" refY="3.8990363547948754" viewBox="-1 -1.3763819204711738 16.23606797749979 10.550836550532098" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1141" d="M12 3.8990363547948754L0 7.798072709589751V0Z " stroke="#323232" stroke-width="2" fill="#323232" transform="matrix(1,0,0,1,0,0)"></path></marker></defs><g id="SvgjsG1007"><path id="SvgjsPath1008" d="M187 193H881V501.875H187V193Z " fill-opacity="0" fill="none"></path><g id="SvgjsG1009"><g id="SvgjsG1010" transform="translate(248 213)" opacity="1"><path id="SvgjsPath1011" d="M0 35L16.666666666666668 0L83.33333333333333 0L100 35L83.33333333333333 70L16.666666666666668 70L0 35Z " stroke-dasharray="none" stroke="#a508b3" stroke-width="2" fill="url(#SvgjsLinearGradient1012)"></path><g id="SvgjsG1015" transform="matrix(1 0 0 1 10 26.875)" fill="#ffffff"><text id="SvgjsText1016" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="40" y="12">启动页</text></g></g><g id="SvgjsG1017" transform="translate(402 213)" opacity="1"><path id="SvgjsPath1018" d="M0 35L16.666666666666668 0L83.33333333333333 0L100 35L83.33333333333333 70L16.666666666666668 70L0 35Z " stroke-dasharray="none" stroke="#a508b3" stroke-width="2" fill="url(#SvgjsLinearGradient1019)"></path><g id="SvgjsG1022" transform="matrix(1 0 0 1 10 26.875)" fill="#ffffff"><text id="SvgjsText1023" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="40" y="12">广告View</text></g></g><g id="SvgjsG1024"><path id="SvgjsPath1025" d="M348 248L375 248L375 248L386.7639320225002 248 " stroke-dasharray="none" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1026)"></path><g id="SvgjsG1028" transform="matrix(1 0 0 1 367.38196601125014 239.875)"><path id="SvgjsPath1029" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1030" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g><g id="SvgjsG1031" transform="translate(207 396)" opacity="1"><path id="SvgjsPath1032" d="M0 5Q0 0 5 0L127 0Q132 0 132 5L132 40Q132 45 127 45L5 45Q0 45 0 40L0 5Z " stroke-dasharray="none" stroke="#006400" stroke-width="2" fill="url(#SvgjsLinearGradient1033)"></path><g id="SvgjsG1036" transform="matrix(1 0 0 1 10 6.25)" fill="#ffffff"><text id="SvgjsText1037" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="56" y="12">SDWebImage</text><text id="SvgjsText1038" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="56" y="28.25">检查本地缓存</text></g></g><g id="SvgjsG1039"><path id="SvgjsPath1040" d="M452 283L452 339.5L273 339.5L273 380.7639320225002 " stroke-dasharray="none" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1041)"></path><g id="SvgjsG1043" transform="matrix(1 0 0 1 370.11803398874986 331.375)"><path id="SvgjsPath1044" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1045" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g><g id="SvgjsG1046" transform="translate(432 360)" opacity="1"><path id="SvgjsPath1047" d="M0 23.625L0 0L84 0L84 23.625Q63 16.875 42 23.625Q21 30.375 0 23.625Z " stroke-dasharray="none" stroke="#0b6cc3" stroke-width="2" fill="url(#SvgjsLinearGradient1048)"></path><g id="SvgjsG1051" transform="matrix(1 0 0 1 0 4.025)" fill="#ffffff"><text id="SvgjsText1052" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="42" y="12">加载页面</text></g></g><g id="SvgjsG1053" transform="translate(432 447)" opacity="1"><path id="SvgjsPath1054" d="M0 27.125L0 0L126 0L126 27.125Q94.5 19.375 63 27.125Q31.5 34.875 0 27.125Z " stroke-dasharray="none" stroke="#0b6cc3" stroke-width="2" fill="url(#SvgjsLinearGradient1055)"></path><g id="SvgjsG1058" transform="matrix(1 0 0 1 0 5.825000000000001)" fill="#ffffff"><text id="SvgjsText1059" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="63" y="12">隐藏广告，展示首页</text></g></g><g id="SvgjsG1060"><path id="SvgjsPath1061" d="M339 418.5L385.5 418.5L385.5 373.5L416.7639320225002 373.5 " stroke-dasharray="none" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1062)"></path><g id="SvgjsG1064" transform="matrix(1 0 0 1 385.5 395.49303398874986)"><path id="SvgjsPath1065" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1066" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g><g id="SvgjsG1067"><path id="SvgjsPath1068" d="M339 418.5L385.5 418.5L385.5 462.5L416.7639320225002 462.5 " stroke-dasharray="none" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1069)"></path><g id="SvgjsG1071" transform="matrix(1 0 0 1 385.5 424.75696601125014)"><path id="SvgjsPath1072" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1073" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g><g id="SvgjsG1074" transform="translate(387 367)" opacity="1"><path id="SvgjsPath1075" d="M0 0L30 0L30 29L0 29Z " stroke-dasharray="none" stroke-width="0" stroke="#323232" fill="none" opacity="1"></path><g id="SvgjsG1076" transform="matrix(1 0 0 1 0 6.375)" fill="#ffffff"><text id="SvgjsText1077" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="15" y="12">Y</text></g></g><g id="SvgjsG1078" transform="translate(591 399.75)" opacity="1"><path id="SvgjsPath1079" d="M0 5Q0 0 5 0L252 0Q257 0 257 5L257 32.5Q257 37.5 252 37.5L5 37.5Q0 37.5 0 32.5L0 5Z " stroke-dasharray="none" stroke="#006400" stroke-width="2" fill="url(#SvgjsLinearGradient1080)"></path><g id="SvgjsG1083" transform="matrix(1 0 0 1 10 10.625)" fill="#ffffff"><text id="SvgjsText1084" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="118.5" y="12">SDWebImage下载最新广告，加入缓存</text></g></g><g id="SvgjsG1085"><path id="SvgjsPath1086" d="M516 373.5L719.5 373.5L719.5 384.5139320225002 " stroke-dasharray="none" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1087)"></path><g id="SvgjsG1089" transform="matrix(1 0 0 1 623.2569660112501 365.375)"><path id="SvgjsPath1090" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1091" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g><g id="SvgjsG1092"><path id="SvgjsPath1093" d="M558 462.5L719.5 462.5L719.5 452.4860679774998 " stroke-dasharray="none" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1094)"></path><g id="SvgjsG1096" transform="matrix(1 0 0 1 643.7569660112501 454.375)"><path id="SvgjsPath1097" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1098" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g><g id="SvgjsG1099" transform="translate(579 213)" opacity="1"><path id="SvgjsPath1100" d="M0 35L16.666666666666668 0L83.33333333333333 0L100 35L83.33333333333333 70L16.666666666666668 70L0 35Z " stroke-dasharray="none" stroke="#a508b3" stroke-width="2" fill="url(#SvgjsLinearGradient1101)"></path><g id="SvgjsG1104" transform="matrix(1 0 0 1 10 26.875)" fill="#ffffff"><text id="SvgjsText1105" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="40" y="12">其他控制器</text></g></g><g id="SvgjsG1106"><path id="SvgjsPath1107" d="M848 418.5L861 418.5L861 313L629 313L629 298.2360679774998 " stroke-dasharray="none" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1108)"></path><g id="SvgjsG1110" transform="matrix(1 0 0 1 796.8680339887499 304.875)"><path id="SvgjsPath1111" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1112" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g><g id="SvgjsG1113" transform="translate(735 360)" opacity="1"><path id="SvgjsPath1114" d="M0 0L61 0L61 27L0 27Z " stroke-dasharray="none" stroke-width="0" stroke="#323232" fill="none" opacity="1"></path><g id="SvgjsG1115" transform="matrix(1 0 0 1 0 5.375)" fill="#ffffff"><text id="SvgjsText1116" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="30.5" y="12">点击广告</text></g></g><g id="SvgjsG1117" transform="translate(711 213)" opacity="1"><path id="SvgjsPath1118" d="M0 35L16.666666666666668 0L83.33333333333333 0L100 35L83.33333333333333 70L16.666666666666668 70L0 35Z " stroke-dasharray="none" stroke="#a508b3" stroke-width="2" fill="url(#SvgjsLinearGradient1119)"></path><g id="SvgjsG1122" transform="matrix(1 0 0 1 10 26.875)" fill="#ffffff"><text id="SvgjsText1123" font-family="微软雅黑,黑体,Arial,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="40" y="12">首页控制器</text></g></g><g id="SvgjsG1124"><path id="SvgjsPath1125" d="M848 418.5L861 418.5L861 313L761 313L761 298.2360679774998 " stroke-dasharray="none" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1126)"></path><g id="SvgjsG1128" transform="matrix(1 0 0 1 861 306.74303398874986)"><path id="SvgjsPath1129" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1130" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g><g id="SvgjsG1131"><path id="SvgjsPath1132" d="M811 248L822.5 248L822.5 248L823.5 248 " stroke-dasharray="none" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1133)"></path><g id="SvgjsG1135" transform="matrix(1 0 0 1 817.25 239.875)"><path id="SvgjsPath1136" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1137" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g><g id="SvgjsG1138"><path id="SvgjsPath1139" d="M679 248L695 248L695 248L695.7639320225002 248 " stroke-dasharray="2 3" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1140)"></path><g id="SvgjsG1142" transform="matrix(1 0 0 1 687.3819660112501 239.875)"><path id="SvgjsPath1143" d="M0 0H0V0H0V0Z " fill="#ffffff" transform="translate(0 0)"></path><text id="SvgjsText1144" font-family="Microsoft Yahei,SimSun" fill="#000000" font-size="13" font-weight="normal" font-style="normal" text-anchor="middle" text-decoration="blink" x="0" y="0"></text></g></g></g></g></svg>
</center>

给出各个流程的实现方法：

**检查本地缓存**。可以利用`SDWebImage`中的`SDWebImageManager`，分布从`缓存（cached）`、`硬盘（disk）`中进行查询，如果存在图片，则直接加载；若没有，隐藏`AdView`。

{% highlight ruby %}
func displayCachedAd() {
    let manange: SDWebImageManager = SDWebImageManager()
    let url = NSURL(string: imageURL)
    if (manange.cachedImageExistsForURL(url) == false) {
        self.hidden = true
    } else {
        showImage()
    }
}

func showImage() {
    adImageView = UIImageView(frame: CGRect(x: 0, y: 0, width: UIScreen.mainScreen().bounds.width, height: UIScreen.mainScreen().bounds.height - sloganHeight))
    if let adImageView = adImageView {
        adImageView.sd_setImageWithURL(NSURL(string: imageURL))
        adImageView.userInteractionEnabled = true
        let singleTap: UITapGestureRecognizer = UITapGestureRecognizer(target: self, action: #selector(AdLaunchView.singleTapAction))
        adImageView.addGestureRecognizer(singleTap)

        addSubview(adImageView)
    }
}
{% endhighlight %}

**下载图片**。利用`SDWebImage`中的`downloadImageWithURL`方法，切记使用的是`SDWebImageManager`中的下载图片方法，而不是`SDWebImageDownloader`，前者支持自动缓存存储管理图片，而后者需要手动管理。这里考虑到数据持久化方式。

{% highlight ruby %}
func requestBanner() {
    SDWebImageManager.sharedManager().downloadImageWithURL(NSURL(string: self.imageURL), options: SDWebImageOptions.AvoidAutoSetImage, progress: nil) { (image:UIImage!, error:NSError!, cacheType:SDImageCacheType, finished:Bool, url:NSURL!) in
        print("图片下载成功")
    }
}
{% endhighlight %}

**制作点击事件**。因为考虑到要从`ViewController`跳转至其他`Controller`，所以使用代理方式进行实现。让持有View的controller自定义跳转方法，这样也增加了灵活性。

{% highlight ruby %}
@objc protocol AdLaunchViewDelegate: NSObjectProtocol {
    func adLaunchView(launchView: AdLaunchView, bannerImageDidClick imageURL: String)
}

@objc func singleTapAction() {
    self.delegate?.adLaunchView(self, bannerImageDidClick: imageURL)
    toHidenState()
}
{% endhighlight %}

在`appDelegate.m`中我们实现点击事件的代理方法。

{% highlight ruby %}
func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject : AnyObject]?) -> Bool {

    window?.makeKeyAndVisible()

    adLaunchView = AdLaunchView(frame: UIScreen.mainScreen().bounds)
    adLaunchView?.delegate = self
    window?.addSubview(adLaunchView!)
    return true;
}
{% endhighlight %}

给出最终结果的demo展示图，代码及相关资料会在文末给出。总体来说，写这个广告页也让我重新读了一遍`SDWebImage`源码，也对`appDelegart`的生命周期更加熟悉。

---

[DGAdLaunchView](https://github.com/dgytdhy/DGAdLaunchView)

[《iOS 源代码分析——SDWebImage》](http://draveness.me/ios-yuan-dai-ma-jie-xi-sdwebimage/)

![](https://github.com/dgytdhy/DGAdLaunchView/blob/master/demo.gif?raw=true)

