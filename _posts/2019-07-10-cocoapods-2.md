---
title:      CocoaPods å†é™© - Resolver ä»²è£å…¥å£è§£æ
date:       2019-07-10 00:00:01
author:     "Desgard_Duan"
categories:
- iOS
- Ruby
tags:
- iOS
---


## å›é¡¾

åœ¨ [CocoaPods å†é™© - æ€»è§ˆ](https://www.desgard.com/cocoapods-1/) ä¸­å·²ç»åˆ†æäº† *CocoaPods* çš„æ•´ä¸ªç»„ä»¶æ„æˆå’ŒèŒè´£ã€‚è¿™ç¯‡åšå®¢å•è¯´åœ¨ **Install** è¿‡ç¨‹ä¸­çš„**ç‰ˆæœ¬ä»²è£**ç®—æ³•ï¼Œå…¶ä¸­åŒ…å«äº† `Resolver` çš„å…¥å£è¿‡ç¨‹ä»¥åŠ [Molinillo]() ä»²è£ç®—æ³•ï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬æ¥å…³æ³¨å…¥å£æ–¹æ¡ˆã€‚

æœ¬æ–‡ä»¥ `1.6.1` ç‰ˆæœ¬ä½œä¸ºåˆ†æã€‚åé¢ä»ä¹‹å‰æ–‡ç«  *[CocoaPods å†é™© - æ€»è§ˆ](https://www.desgard.com/cocoapods-1/)* è¯´åˆ°çš„ `resolve_dependencies` ä¾èµ–è§£ææµç¨‹æµç¨‹è¯´èµ·ã€‚


{% highlight ruby %}
def resolve_dependencies
  # æ‹¿åˆ° plugin sources
  plugin_sources = run_source_provider_hooks
  # åˆ›å»ºä¸€ä¸ª Analyzer
  # Analyzer æ˜¯é€šè¿‡åˆ†æ, Podfile.lock, plugin_sources è¿”å›ä¸€ä¸ª AnalysisResult
  # AnalysisResult åŒ…æ‹¬äº† CocoaPods ä¾èµ–ç¯å¢ƒã€CocoaPods å¤„ç†ååœ¨ xcodeproj ä¸­çš„éƒ¨åˆ†ä¿¡æ¯ç­‰ã€‚
  analyzer = create_analyzer(plugin_sources)

  # å¦‚æœæ ‡è®°äº† repo_update (åœ¨ pod update æˆ–è€… pod install --repo-update æ—¶ç”Ÿæ•ˆ)
  UI.section 'Updating local specs repositories' do
    # æ›´æ–° $HOME ç›®å½•ä¸‹ CocoaPods çš„æœ¬åœ° Specs ä»“åº“
    analyzer.update_repositories
  end if repo_update?

  UI.section 'Analyzing dependencies' do
    # è°ƒç”¨ Analyzer ç­‰ analyze æ–¹æ³•å…¥å£ï¼Œå¹¶æŠŠéƒ¨åˆ†ç»“æœæ‹¿å› install ç±»ä¸­
    analyze(analyzer)
    # æ‹¼å†™é”™è¯¯é™çº§è¯†åˆ«ï¼Œç™½åå•è¿‡æ»¤
    validate_build_configurations
    # æ¸…ç† sandbox ç›®å½•
    clean_sandbox
  end

  UI.section 'Verifying no changes' do
    verify_no_podfile_changes!
    verify_no_lockfile_changes!
  end if deployment?

  analyzer
end
{% endhighlight %}

åœ¨ç¬¬ä¸€æ¬¡æ„å»ºä¾èµ–å›¾çš„æ—¶å€™ï¼Œç”±äº *Molinillo* éœ€è¦æ‹¿åˆ°æ‰€æœ‰çš„ä¾èµ–ä¿¡æ¯ï¼Œæ‰€ä»¥è¦åœ¨ `Analyzer` åˆ†æå‡ºæ‰€æœ‰ä¾èµ–èŠ‚ç‚¹æ‰å¯ä»¥æ„å»ºåˆå§‹çŠ¶æ€çš„ä¾èµ–å›¾ã€‚

## *Resolver* çš„ä¾èµ–ä»²è£

Ruby çš„é¡¹ç›®ä¸­ï¼Œå¾€å¾€æœ€å¤´ç–¼çš„å°±æ˜¯æ¢³ç†å„ç§å„æ ·çš„ `Class` å’Œ `Module`ï¼Œåœ¨çœ‹ `Molinillo` è¿™ä¸ªç»„ä»¶ä¹‹å‰ï¼Œç¬”è€…å…ˆæ•´ä½“æµè§ˆäº†ä¸€ä¸‹è¿™ä¸ªåº“çš„ä»£ç ç»“æ„ã€‚åœ¨ `CocoaPods` é¡¹ç›®ä¸­çš„ç®—æ³•å…¥å£å…¶å®æ˜¯åœ¨ `/lib/cocoapods/resolver.rb` è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚ä½ ä»å®ƒç¬¬ä¸€è¡Œçš„ `require 'molinillo'` å°±å¯ä»¥æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ğŸ˜‚ã€‚

æ‰€ä»¥æˆ‘åœ¨å…¶ `initialize` æ–¹æ³•å¤„ï¼Œæ‰“å°äº†è¿è¡Œå †æ ˆï¼Œå¹¶ä¸” `raise` æ‰æ•´ä¸ªæµç¨‹æ¥è°ƒè¯• `pod install` çš„è¿‡ç¨‹ï¼Œå…¶ Log å¦‚ä¸‹ï¼š

{% highlight json %}
lib/cocoapods/installer/analyzer.rb:908:in `new'
lib/cocoapods/installer/analyzer.rb:908:in `block in resolve_dependencies'
lib/cocoapods/user_interface.rb:64:in `section'
lib/cocoapods/installer/analyzer.rb:907:in `resolve_dependencies'
lib/cocoapods/installer/analyzer.rb:114:in `analyze'
lib/cocoapods/installer.rb:266:in `analyze'
lib/cocoapods/installer.rb:174:in `block in resolve_dependencies'
lib/cocoapods/user_interface.rb:64:in `section'
lib/cocoapods/installer.rb:173:in `resolve_dependencies'
{% endhighlight %}

æˆ‘ä»¬ä» `resolve_dependencies` æ–¹æ³•è¿›å…¥åï¼Œåœ¨å®ä¾‹åŒ– `Analyze` ä¹‹åï¼Œå…¶å¯¹è±¡çš„ `analyze` æ–¹æ³•ä¼šåœ¨æ–‡ä»¶çš„ 907 è¡Œï¼ˆè¿™ä¸ªä¸æ˜¯ç»å¯¹çš„ï¼‰è°ƒç”¨ `resolve_dependencies` ä»è€Œè§¦å‘äº†å®ä¾‹åŒ– `Resolver` å¯¹è±¡çš„æ„é€ æ–¹æ³•ã€‚

ä¸‹é¢æ¥çœ‹ `analyze` æ˜¯ä¸ºä»€ä¹ˆè¦å®ä¾‹åŒ– `Resolver` å¯¹è±¡ã€‚

{% highlight ruby %}
def analyze(allow_fetches = true)
  # å¦‚æœå·²ç»æœ‰åˆ†æç»“æœï¼Œç›´æ¥è¿”å›
  return @result if @result
  # æ ¡éªŒ Podfile
  validate_podfile!
  # æ ¡éªŒ Podfile.lock æ–‡ä»¶ä¸­ CocoaPods çš„ç‰ˆæœ¬
  validate_lockfile_version!
  if installation_options.integrate_targets?
    # é¢„å¤„ç† Podfile ä¸­æ¯ä¸ª target ä¿¡æ¯
    target_inspections = inspect_targets_to_integrate
  else
    # æ ¡éªŒå£°æ˜çš„ platform ä¿¡æ¯
    verify_platforms_specified!
    target_inspections = {}
  end
  # è°ƒç”¨ generate_podfile_state æ¥è®°å½• sandbox å†…æ¯ä¸€ä¸ª Pod çš„å˜åŒ–
  podfile_state = generate_podfile_state

  # è¿™é‡Œè¦å­˜å‚¨é Source Spec ä¸‹çš„ Options
  # å³ Podfile.lock ä¸­çš„ CHECKOUT OPTIONS å­—æ®µ
  # é€šè¿‡ KV æ–¹å¼è¿›è¡Œé¢„å­˜ï¼ŒKey ä¸º Pod çš„ Root Name
  store_existing_checkout_options
  if allow_fetches == :outdated
    # special-cased -- we're only really resolving for outdated, rather than doing a full analysis
    # ç‰¹æ®Šè¾¹ç•Œæƒ…å†µï¼Œå¦‚æœ outdated åˆ™ä¸å‚ä¸å…¨ä¾èµ–åˆ†æ
  elsif allow_fetches == true
    # è¢«å‘ŠçŸ¥éœ€è¦ fetchï¼Œåˆ™è¯´æ˜æˆ‘ä»¬éœ€è¦ fetch åˆ°è¿œç¨‹ä»“åº“åˆ° spec æ–‡ä»¶
    fetch_external_sources(podfile_state)
  elsif !dependencies_to_fetch(podfile_state).all?(&:local?)
    # éœ€è¦æ£€æŸ¥å¦‚æœéœ€è¦æ›´æ–°åˆ° spec æœ¬åœ°å·²ç»æœ‰å¯¹åº”ç‰ˆæœ¬ï¼Œåˆ™é€šè¿‡
    # å¦åˆ™è·‘å‡ºå¼‚å¸¸ï¼Œå‘ŠçŸ¥ sandbox ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬
    raise Informative, 'Cannot analyze without fetching dependencies since the sandbox is not up-to-date. Run `pod install` to ensure all dependencies have been fetched.' \
      "\n    The missing dependencies are:\n    \t#{dependencies_to_fetch(podfile_state).reject(&:local?).join("\n    \t")}"
  end

  # è¦ç‚¹ä¸€ï¼šå–å‡º Podfile.lock ä¸­æ‰€æœ‰çš„ä¾èµ–
  # è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªåˆå§‹åŒ–çš„ä¾èµ–å›¾ï¼Œå¸¦æœ‰ Podfile.lock ä¸­å·²ç» lock çš„æ‰€æœ‰ä¾èµ–æ„æˆçš„å¤š root å›¾
  locked_dependencies = generate_version_locking_dependencies(podfile_state)
  # locked_dependencies.each do |item|
  #   puts item.name
  #   puts item.payload
  #   puts item.root
  # end
  # è¦ç‚¹äºŒï¼šæ ¹æ® Target å¯¹ Podfile ä¸­çš„æè¿°æ¥å¯¹ spec è¿›è¡Œåˆ†ç»„
  resolver_specs_by_target = resolve_dependencies(locked_dependencies)
  # æ ¡éªŒ platform åˆæ³•æ€§
  validate_platforms(resolver_specs_by_target)
  # Spec å¯¹å®ä¾‹æ•°ç»„
  specifications  = generate_specifications(resolver_specs_by_target)
  # åŸå·¥ç¨‹ä¸­å¯¹ Targets å®ä¾‹æ•°ç»„
  targets         = generate_targets(resolver_specs_by_target, target_inspections)
  # Pod Project çš„ Targets å®ä¾‹æ•°ç»„
  pod_targets     = calculate_pod_targets(targets)
  # Sandbox ä¸­ Spec æ•°ç»„ï¼Œå¯ç†è§£æˆä¸ Manifest çŠ¶æ€åŒæ­¥
  sandbox_state   = generate_sandbox_state(specifications)
  # æ ¹æ® target å¯¹ Spec åšåˆ†ç»„æ“ä½œ
  specs_by_target = resolver_specs_by_target.each_with_object({}) do |rspecs_by_target, hash|
    hash[rspecs_by_target[0]] = rspecs_by_target[1].map(&:spec)
  end
  # æ ¹æ® sources å¯¹ Spec åšåˆ†ç»„æ“ä½œ
  specs_by_source = Hash[resolver_specs_by_target.values.flatten(1).group_by(&:source).map do |source, specs|
    [source, specs.map(&:spec).uniq]
  end]
  sources.each { |s| specs_by_source[s] ||= [] }
  # è¦ç‚¹ä¸‰ï¼šè¿”å›ä¸€ä¸ª AnalysisResult å®ä¾‹ï¼Œå¾—åˆ°æœ€ç»ˆçš„ä»²è£ç»“æœ
  @result = AnalysisResult.new(podfile_state, specs_by_target, specs_by_source, specifications, sandbox_state,
                               targets, pod_targets, @podfile_dependency_cache)
end
{% endhighlight %}

### è¦ç‚¹ä¸€ï¼š`SpecsState` æº¯æº

`analysis` æ–¹æ³•æ˜¯è¿›å…¥ `Molinillo` çš„å…¥å£ï¼Œ`generate_version_locking_dependencies` æ–¹æ³•æ˜¯ç”¨æ¥ç”Ÿæˆ `Podfile.lock` ä¸­ `Pods` å­—æ®µã€‚è¿½æœ¬æº¯æºï¼Œå¯ä»¥å…ˆçœ‹ä¸‹ `generate_podfile_state` è¿™ä¸ªæ–¹æ³•ï¼š

{% highlight ruby %}
def generate_podfile_state
  if lockfile
    pods_state = nil
    UI.section 'Finding Podfile changes' do
      # diff podfile è§£æç»“æœ
      pods_by_state = lockfile.detect_changes_with_podfile(podfile)
      # é€šè¿‡ diff ç»“æœç”Ÿæˆ SpecsState å®ä¾‹
      pods_state = SpecsState.new(pods_by_state)
      # verbose ä¸‹è¾“å‡º log
      pods_state.print if config.verbose?
    end
    pods_state
  else
    state = SpecsState.new
    # å¦‚æœæ²¡æœ‰ lock æ–‡ä»¶å–å‡º
    state.added.merge(podfile_dependencies.map(&:root_name))
    state
  end
end
{% endhighlight %}

æºç å±‚é¢ä¸Šæ¥çœ‹ï¼Œåœ¨è·å– `SpecsState` çš„åˆå§‹çŠ¶æ€ï¼Œä¼šå‚è€ƒ `Podfile` å’Œ `Podfile.lock` æ–‡ä»¶ä¸­è®°å½•çš„ä¿¡æ¯ã€‚ä¸€æ¬¡çš„ Analysis è¿‡ç¨‹ä¼šç»´æŠ¤ä¸€ä¸ª `SpecsState` å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è®°å½•äº†å¤šä¸ªçŠ¶æ€æ•°ç»„ï¼Œé‡Œé¢è®°å½•äº†**å¢**ã€**åˆ **ã€**æ”¹**ã€**ä¸æ”¹**å››ä¸ªçŠ¶æ€ã€‚

{% highlight ruby %}
class SpecsState
  # @return [Set<String>] éœ€è¦è¿›è¡Œå¢æ“ä½œçš„ Pod Name é›†åˆ
  #
  attr_reader :added

  # @return [Set<String>] éœ€è¦è¿›è¡Œæ”¹æ“ä½œçš„ Pod Name é›†åˆ
  #
  attr_reader :changed

  # @return [Set<String>] éœ€è¦è¿›è¡Œåˆ æ“ä½œçš„ Pod Name é›†åˆ
  #
  attr_reader :deleted

  # @return [Set<String>] æ— éœ€ä¿®æ”¹çš„ Pod Name é›†åˆ
  #
  attr_reader :unchanged
end
{% endhighlight %}

![SpecsState](/assets/images/blog/15536584001140/SpecsState.png)


åœ¨äºŒæ¬¡ `pod install` çš„æ—¶å€™è¾“å‡ºåˆå§‹åŒ–æ¯”å¯¹åè¿”å›çš„ `SpecsState` ä¸­çš„æ•°æ®ï¼š

{% highlight ruby %}
å¢åŠ  #<Set: {}>
åˆ é™¤ #<Set: {}>
ä¸æ”¹ #<Set: {"AcknowList", "ActiveLabel", "Alamofire", "AlamofireObjectMapper", "CocoaLumberjack", "CollectionKit", "Crashlytics", "Curiouscat", "DeviceKit", "DTCoreText", "DWAnimatedLabel", "EFQRCode", "Fabric", "FaveButton", "Firebase", "FLEX", "FTPopOverMenu_Swift", "GDMDebugger", "Highlightr", "KVOController", "lottie-ios", "LTMorphingLabel", "MJRefresh", "MMMarkdown", "NVActivityIndicatorView", "ObjectMapper", "pop", "PySwiftyRegex", "ReachabilitySwift", "SDWebImage", "SGQRCode", "SkeletonView", "SnapKit", "Straycat", "SwiftMessages", "SwiftyUserDefaults", "SwipeCellKit", "ViewAnimator", "WCDB.swift", "WCLShineButton", "WechatOpenSDK", "XLPagerTabStrip"}>
ä¿®æ”¹ #<Set: {}>
{% endhighlight %}

å‘ç° `Podfile` ä¸­å£°æ˜çš„ Pod ä¾èµ–å…¨éƒ¨è¿›å…¥äº† `unchanged` é›†åˆï¼Œç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚åœ¨è¿™ä¹‹åï¼Œå°† `SpecsState` ä¼ å…¥ `generate_version_locking_dependencies` ä¸­æ¥ç»§ç»­å¤„ç†ã€‚å½“ç„¶è¿™ä¸€åˆ‡éƒ½ä¾æ‰˜äº**æˆ‘ä»¬å½“å‰ç›®å½•ä¸‹æœ‰ `Podfile.lock` æ–‡ä»¶**ã€‚

{% highlight ruby %}
def generate_version_locking_dependencies(podfile_state)
  if update_mode == :all || !lockfile
    LockingDependencyAnalyzer.unlocked_dependency_graph
  else
    # ä» state ä¸­è·å–å‡º deleted å’Œ changed çš„ Pod
    deleted_and_changed = podfile_state.changed + podfile_state.deleted
    # å·²ç»æ›´æ–°çš„æ‰€æœ‰ Pods æˆ–è€…æ˜¯åº”è¯¥æ›´æ–°çš„ Pods åŠ å…¥æ•°ç»„ï¼Œåœ¨é lock çŠ¶æ€ä¸‹
    deleted_and_changed += pods_to_update[:pods] if update_mode == :selected
    # è·å–å‡ºæ‰€æœ‰ path æŒ‡å‘çš„ Pod åï¼Œè¿™é‡Œåªå…³å¿ƒ root_name
    local_pod_names = podfile_dependencies.select(&:local?).map(&:root_name)
    # local pods ä¸è¿›è¡Œ lock
    pods_to_unlock = local_pod_names.to_set.delete_if do |pod_name|
      next unless sandbox_specification = sandbox.specification(pod_name)
      sandbox_specification.checksum == lockfile.checksum(pod_name)
    end
    # æ ¹æ® lock æ–‡ä»¶ä»¥åŠç›¸å…³ä¿¡æ¯ç”Ÿæˆä¾èµ–å›¾ï¼Œå¹¶è¿”å›
    LockingDependencyAnalyzer.generate_version_locking_dependencies(lockfile, deleted_and_changed, pods_to_unlock)
  end
end
{% endhighlight %}

#### æœ‰ Podfile.lock æ¡ä»¶ - ç”Ÿæˆç‰ˆæœ¬ Locking å›¾

`LockingDependencyAnalyzer` è¿™ä¸ªç±»ç”¨æ¥ç”Ÿæˆæœªä¿®æ”¹çš„ Pod ä¾èµ–é¡¹ï¼Œè¿™äº›ä¾èµ–æ˜¯å­˜åœ¨äº `Podfile.lock` ä¸­ä¸”æ ‡è®°æˆéæ›´æ–°çŠ¶æ€çš„ã€‚å¦‚æœæ˜¯åœ¨éæ›´æ–°æ¨¡å¼ï¼Œ`pods_by_state` é€šè¿‡ `LockingDependencyAnalyzer` åˆå§‹åŒ–ä¸€ä¸ªç»“æœä¼ é€’ç»™ `Resolver` æ¥**å›ºåŒ–**è¿™äº› Pod ç‰ˆæœ¬ã€‚

{% highlight ruby %}
# è‡ªå·±æ·»åŠ çš„æŸ¥è¯¢å›¾èŠ‚ç‚¹çš„ log æ–¹æ³•
def self.check_dependency_graph(graph)
  puts "check dependency graph"
  res = []
  graph.each do |vertex|
    res << "#{vertex.payload}"
  end
  print res
  puts ""
end

# module Pod => class Installer => class Analysis => module LockingDependencyAnalyzer

def self.generate_version_locking_dependencies(lockfile, pods_to_update, pods_to_unlock = [])
  # lockfile - lock æ–‡ä»¶
  # pods_to_update - æ ‡è®°éœ€è¦æ›´æ–°çš„ Pod é›†åˆ
  # pods_to_unlock - ä¸éœ€ lock çš„ Pod é›†åˆ
  puts("lockfile => ", lockfile.pod_names)
  puts("pods_to_update => ", pods_to_update)
  puts("pods_to_unlock => ", pods_to_unlock)
        
  dependency_graph = Molinillo::DependencyGraph.new

  if lockfile
    added_dependency_strings = Set.new

    # æ‹¿å‡ºæ‰€æœ‰çš„æ˜¾å¼ä¾èµ–
    explicit_dependencies = lockfile.dependencies
    explicit_dependencies.each do |dependency|
      check_dependency_graph(dependency_graph)

      # å¯¹ä¾èµ–å›¾è¿›è¡ŒåŠ é¡¶ç‚¹ï¼Œå¹¶ä¸”ç¡®å®šä¸º root èŠ‚ç‚¹
      dependency_graph.add_vertex(dependency.name, dependency, true)
    end

    # å–å‡º lockfile ä¸­ PODS å­—æ®µå†…å®¹
    # è¿™ä¸ªå­—æ®µåŒ…å«äº†ä¸Šæ¬¡è®°å½•çš„æ‰€æœ‰ä¾èµ–
    pods = lockfile.to_hash['PODS'] || []
    # éå†æ‰€æœ‰ Pods è¿›è¡Œå¢åŠ  root ç‚¹æ“ä½œ
    pods.each do |pod|
      check_dependency_graph(dependency_graph)
      # ç»§ç»­åœ¨å›¾ä¸­åŠ ç‚¹ï¼Œç”±äºå–çš„æ˜¯ PODS å­—æ®µï¼Œæ‰€æœ‰ä¾èµ–å…¨éƒ¨åŠ å…¥
      add_to_dependency_graph(pod, [], dependency_graph, pods_to_unlock, added_dependency_strings)
    end

    # å°† update æ•°ç»„ä¸­çš„ä¾èµ–é€šè¿‡ root name è¿›è¡Œè½¬æ¢
    pods_to_update = pods_to_update.flat_map do |u|
      root_name = Specification.root_name(u).downcase
      dependency_graph.vertices.each_key.select { |n| Specification.root_name(n).downcase == root_name }
    end

    # å°†å¾…æ›´æ–°èŠ‚ç‚¹åšæ‹†ç‚¹æ“ä½œ
    pods_to_update.each do |u|
      dependency_graph.detach_vertex_named(u)
    end

    # éå†å›¾æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¢åŠ  spec ä»“çš„ git åœ°å€
    dependency_graph.each do |vertex|
      next unless dep = vertex.payload
      dep.podspec_repo ||= lockfile.spec_repo(dep.root_name)
    end
  end

  dependency_graph
end

def self.add_child_vertex_to_graph(dependency_string, parents, dependency_graph, pods_to_unlock, added_dependency_strings)
  # è¿™é‡Œçš„å»é‡ç”¨äº† Set çš„ç‰¹æ€§ï¼Œå¦‚æœæ˜¯é‡å¤çš„å…ƒç´ ï¼Œåœ¨ Set.add? ä¹‹åä¼šè¿”å› null
  # æ‰€ä»¥è¿™é‡Œå¦‚æœæ˜¯é‡å¤çš„èŠ‚ç‚¹ï¼Œå°±ç›´æ¥ return
  return unless added_dependency_strings.add?(dependency_string)
  # é€šè¿‡æè¿°å­—ç¬¦ä¸²è·å–å‡º Dependency å®ä¾‹
  dependency = Dependency.from_string(dependency_string)
  # å¦‚æœåœ¨ pods_to_unlock è¿™ä¸ªæœªåŠ é”æ•°ç»„ä¸­ï¼Œåˆ™åªä½¿ç”¨ Pods åæ¥å®ä¾‹åŒ– Dependency
  if pods_to_unlock.include?(dependency.root_name)
    dependency = Dependency.new(dependency.name)
  end
  # åŠ è¾¹æ“ä½œ
  vertex = dependency_graph.add_child_vertex(dependency.name, nil, parents, nil)
  # å¦‚æœæœ‰ payload ä¿¡æ¯ï¼Œåˆ™åˆå¹¶ç‰ˆæœ¬çº¦æŸ
  dependency = vertex.payload.merge(dependency) if vertex.payload
  puts "åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload ", dependency
  # ä¿®æ”¹èŠ‚ç‚¹çš„ payload ä¿¡æ¯
  vertex.payload = dependency
  dependency
end

def self.add_to_dependency_graph(object, parents, dependency_graph, pods_to_unlock, added_dependency_strings)
  # å¦‚æœæ˜¯ String ç±»å‹ï¼Œä»£è¡¨æ˜¯å•ä¸€ä¾èµ–ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹
  # Hash ä¼šå¸¦ä¸Šä¸€ç»„ä¾èµ–å…³ç³»
  case object
  when String
    add_child_vertex_to_graph(object, parents, dependency_graph, pods_to_unlock, added_dependency_strings)
  when Hash
    object.each do |key, value|
      dependency = add_child_vertex_to_graph(key, parents, dependency_graph, pods_to_unlock, added_dependency_strings)
      # ç”±äº PODS ä¿¡æ¯ä¸­åªæœ‰äºŒçº§ä¾èµ–å…³ç³»ï¼Œæ‰€æœ‰åªéå†ä¸€å±‚éšå¼ä¾èµ–å³å¯
      value.each { |v| add_to_dependency_graph(v, [dependency.name], dependency_graph, pods_to_unlock, added_dependency_strings) }
    end
  end
end
{% endhighlight %}

åœ¨æˆ‘ä»¬æ‹¥æœ‰ `Podfile.lock` çš„æƒ…å†µä¸‹ï¼Œæ„å»ºè¿™ä¸ªåˆå§‹å›¾å°±æ˜¯æ¯”è¾ƒå®¹æ˜“çš„äº‹æƒ…ã€‚é‡æ–°æ¢³ç†ä¸€ä¸‹è¿™ä¸ªæµç¨‹ã€‚é¦–å…ˆæˆ‘ä»¬è§£æå®Œ `Podfile.lock` å’Œ `Podfile` ä¹‹åï¼Œæ„é€ äº†ä¸€ä¸ª `SpecsState` å®ä¾‹ï¼Œè¿™é‡Œé¢ä¼šåˆ†æå‡º**å¢ã€åˆ ã€æ”¹ã€æœªæ”¹**è¿™å››ä¸ª Pod æ•°ç»„ã€‚ç”±äºå·²ç»å­˜åœ¨ `Podfile.lock` æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„ `Dependency` å­—æ®µï¼Œä¹Ÿå°±æ˜¯ `Podfile` é‡Œçš„æ˜¾ç¤ºä¾èµ–æ‹¿å‡ºæ¥æ„é€ å¤šä¸ª *root* èŠ‚ç‚¹ã€‚åœ¨ä»¥ä¸‹ Log ä¸­ï¼Œæˆ‘ç”¨ï¼ˆä¾èµ–æ¯”è¾ƒå°‘çš„ï¼‰æ–°é¡¹ç›®æ¥åšæµ‹è¯•ï¼š

{% highlight ruby %}
check dependency graph
[]
åŠ ç‚¹ Alamofire Alamofire (~> 4.7.3) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)"]
åŠ ç‚¹ AlamofireObjectMapper AlamofireObjectMapper (~> 5.0) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)"]
åŠ ç‚¹ CocoaLumberjack/Swift CocoaLumberjack/Swift æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift"]
åŠ ç‚¹ DeviceKit DeviceKit (~> 2.0) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)"]
åŠ ç‚¹ ESTabBarController-swift ESTabBarController-swift æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift"]
åŠ ç‚¹ FLEX FLEX (~> 2.0) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)"]
åŠ ç‚¹ IQKeyboardManagerSwift IQKeyboardManagerSwift (~> 6.2.0) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)"]
åŠ ç‚¹ KVOController KVOController æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController"]
åŠ ç‚¹ ObjectMapper ObjectMapper (~> 3.1) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)"]
åŠ ç‚¹ pop pop (~> 1.0) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)", "pop (~> 1.0)"]
åŠ ç‚¹ Reveal-SDK Reveal-SDK (from `Reveal`) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)"]
åŠ ç‚¹ SDWebImage SDWebImage (~> 4.4.6) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)"]
åŠ ç‚¹ SnapKit SnapKit (~> 5.0.0) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)"]
åŠ ç‚¹ SwifterSwift SwifterSwift (~> 5.0.0) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)"]
åŠ ç‚¹ SwiftMessages SwiftMessages (~> 6.0.2) æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)"]
åŠ ç‚¹ SwiftyUserDefaults SwiftyUserDefaults æ ¹èŠ‚ç‚¹
check dependency graph
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults"]
{% endhighlight %}

![](/assets/images/blog/15536584001140/15598085316457.jpg)


å¯ä»¥çœ‹åˆ°åœ¨ä¾èµ–å›¾ä¸­ä¸æ–­çš„å¢åŠ æ ¹èŠ‚ç‚¹ã€‚è¿™äº›èŠ‚ç‚¹æ˜¯ `Podfile.lock` ä¸­çš„ `Dependency` å­—æ®µæ‰€æœ‰ä¾èµ–ã€‚ç„¶åæ ¹æ® `Podfile.lock` çš„ `Pods` è¿›è¡Œå®Œæ•´å›¾çš„æ„å»ºã€‚ä»¥ä¸‹æ˜¯è¾“å‡ºæµ‹è¯• Logï¼š

{% highlight ruby %}
["Alamofire (~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults"]
åŠ ç‚¹ Alamofire  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
Alamofire (= 4.7.3, ~> 4.7.3)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7.3)", "AlamofireObjectMapper (~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults"]
åŠ ç‚¹ AlamofireObjectMapper  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
AlamofireObjectMapper (= 5.2.0, ~> 5.0)
åŠ ç‚¹ Alamofire  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ AlamofireObjectMapper => Alamofire
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)
åŠ ç‚¹ ObjectMapper  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ AlamofireObjectMapper => ObjectMapper
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
ObjectMapper (~> 3.1, ~> 3.4)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1, ~> 3.4)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults"]
åŠ ç‚¹ CocoaLumberjack/Core  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
CocoaLumberjack/Core (= 3.5.3)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1, ~> 3.4)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ CocoaLumberjack/Swift  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
CocoaLumberjack/Swift (= 3.5.3)
åŠ ç‚¹ CocoaLumberjack/Core  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ CocoaLumberjack/Swift => CocoaLumberjack/Core
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
CocoaLumberjack/Core (= 3.5.3)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1, ~> 3.4)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ DeviceKit  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
DeviceKit (= 2.0.0, ~> 2.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1, ~> 3.4)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ ESTabBarController-swift  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
ESTabBarController-swift (= 2.7)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1, ~> 3.4)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ FLEX  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
FLEX (= 2.4.0, ~> 2.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1, ~> 3.4)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ IQKeyboardManagerSwift  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController", "ObjectMapper (~> 3.1, ~> 3.4)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ KVOController  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
KVOController (= 1.2.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (~> 3.1, ~> 3.4)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ ObjectMapper  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ pop  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
pop (= 1.0.12, ~> 1.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ Reveal-SDK  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
Reveal-SDK (from `Reveal`)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)"]
åŠ ç‚¹ SDWebImage  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SDWebImage (= 4.4.6, ~> 4.4.6)
åŠ ç‚¹ SDWebImage/Core  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SDWebImage => SDWebImage/Core
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SDWebImage/Core (= 4.4.6)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)"]
åŠ ç‚¹ SDWebImage/Core  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SDWebImage/Core (= 4.4.6)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)"]
åŠ ç‚¹ SnapKit  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SnapKit (= 5.0.0, ~> 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)"]
åŠ ç‚¹ SwifterSwift  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift (= 5.0.0, ~> 5.0.0)
åŠ ç‚¹ SwifterSwift/AppKit  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwifterSwift => SwifterSwift/AppKit
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/AppKit (= 5.0.0)
åŠ ç‚¹ SwifterSwift/CoreGraphics  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwifterSwift => SwifterSwift/CoreGraphics
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/CoreGraphics (= 5.0.0)
åŠ ç‚¹ SwifterSwift/CoreLocation  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwifterSwift => SwifterSwift/CoreLocation
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/CoreLocation (= 5.0.0)
åŠ ç‚¹ SwifterSwift/Dispatch  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwifterSwift => SwifterSwift/Dispatch
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/Dispatch (= 5.0.0)
åŠ ç‚¹ SwifterSwift/Foundation  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwifterSwift => SwifterSwift/Foundation
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/Foundation (= 5.0.0)
åŠ ç‚¹ SwifterSwift/MapKit  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwifterSwift => SwifterSwift/MapKit
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/MapKit (= 5.0.0)
åŠ ç‚¹ SwifterSwift/SpriteKit  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwifterSwift => SwifterSwift/SpriteKit
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/SpriteKit (= 5.0.0)
åŠ ç‚¹ SwifterSwift/SwiftStdlib  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwifterSwift => SwifterSwift/SwiftStdlib
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/SwiftStdlib (= 5.0.0)
åŠ ç‚¹ SwifterSwift/UIKit  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwifterSwift => SwifterSwift/UIKit
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/UIKit (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwifterSwift/AppKit  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/AppKit (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwifterSwift/CoreGraphics  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/CoreGraphics (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwifterSwift/CoreLocation  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/CoreLocation (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwifterSwift/Dispatch  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/Dispatch (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwifterSwift/Foundation  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/Foundation (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwifterSwift/MapKit  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/MapKit (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwifterSwift/SpriteKit  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/SpriteKit (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwifterSwift/SwiftStdlib  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/SwiftStdlib (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwifterSwift/UIKit  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwifterSwift/UIKit (= 5.0.0)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)"]
åŠ ç‚¹ SwiftMessages  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwiftMessages (= 6.0.2, ~> 6.0.2)
åŠ ç‚¹ SwiftMessages/App  éæ ¹èŠ‚ç‚¹
åŠ è¾¹ SwiftMessages => SwiftMessages/App
	 requirement 
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwiftMessages/App (= 6.0.2)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (= 6.0.2, ~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)", "SwiftMessages/App (= 6.0.2)"]
åŠ ç‚¹ SwiftMessages/App  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwiftMessages/App (= 6.0.2)
check dependency graph
["Alamofire (= 4.7.3, ~> 4.7, ~> 4.7.3)", "AlamofireObjectMapper (= 5.2.0, ~> 5.0)", "CocoaLumberjack/Swift (= 3.5.3)", "DeviceKit (= 2.0.0, ~> 2.0)", "ESTabBarController-swift (= 2.7)", "FLEX (= 2.4.0, ~> 2.0)", "IQKeyboardManagerSwift (= 6.2.1, ~> 6.2.0)", "KVOController (= 1.2.0)", "ObjectMapper (= 3.4.2, ~> 3.1, ~> 3.4)", "pop (= 1.0.12, ~> 1.0)", "Reveal-SDK (from `Reveal`)", "SDWebImage (= 4.4.6, ~> 4.4.6)", "SnapKit (= 5.0.0, ~> 5.0.0)", "SwifterSwift (= 5.0.0, ~> 5.0.0)", "SwiftMessages (= 6.0.2, ~> 6.0.2)", "SwiftyUserDefaults", "CocoaLumberjack/Core (= 3.5.3)", "SDWebImage/Core (= 4.4.6)", "SwifterSwift/AppKit (= 5.0.0)", "SwifterSwift/CoreGraphics (= 5.0.0)", "SwifterSwift/CoreLocation (= 5.0.0)", "SwifterSwift/Dispatch (= 5.0.0)", "SwifterSwift/Foundation (= 5.0.0)", "SwifterSwift/MapKit (= 5.0.0)", "SwifterSwift/SpriteKit (= 5.0.0)", "SwifterSwift/SwiftStdlib (= 5.0.0)", "SwifterSwift/UIKit (= 5.0.0)", "SwiftMessages/App (= 6.0.2)"]
åŠ ç‚¹ SwiftyUserDefaults  éæ ¹èŠ‚ç‚¹
åˆå¹¶ç‰ˆæœ¬çº¦æŸ payload 
SwiftyUserDefaults (= 4.0.0)
{% endhighlight %}

![](/assets/images/blog/15536584001140/15598137112070.jpg)

é€šè¿‡è§£æ `Pods` å­—æ®µï¼Œå°†æˆ‘ä»¬çš„ä¾èµ–å›¾æ‰©å±•æˆä¸€ä¸ª**éè¿é€šå›¾**ã€‚å…¶ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šèƒŒæœ‰ä¸€ä¸ª `payload` æƒå€¼ï¼Œåé¢æˆ‘ä»¬ç§°ä¸º**ä¾èµ–çº¦æŸæ¡ä»¶**ã€‚å¦å¤–åœ¨å–å‡º `Pods` å­—æ®µçš„æ—¶å€™ï¼Œä¼šä¿ç•™æ‰€æœ‰ä¾èµ–çš„éšå¼ä¾èµ–çš„**ä¾èµ–çº¦æŸæ¡ä»¶**ï¼Œåœ¨ä¸Šæ–‡ä¸­çš„åŠ è¾¹æ“ä½œå…¥å£ä¸­çš„ `add_child_vertex_to_graph` æ–¹æ³•ï¼Œå†…éƒ¨æœ‰è°ƒç”¨å¯¹äºèŠ‚ç‚¹çš„ `payload.merge` æ–¹æ³•ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªçº¦æŸåˆå…¥åˆ°çº¦æŸæ•°ç»„ä¸­ï¼Œä»¥ä¾¿åç»­çš„ä¾èµ–ä»²è£è¿‡ç¨‹æ¿€æ´»ä½¿ç”¨ã€‚

#### æ—  Podfile.lock æ¡ä»¶ - æ— çº¦æŸé‡æ–°åˆ›å»ºå›¾

æ²¡æœ‰ä»»ä½• `Podfile.lock` å‚è€ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±é‡æ–°å»æ„å»ºæ•´å¼ ä¾èµ–å›¾ã€‚

{% highlight ruby %}
def self.unlocked_dependency_graph
  Molinillo::DependencyGraph.new
end
{% endhighlight %}

æˆ‘ä»¬å¯ä»¥å°è¯•å°† `Podfile.lock` æ–‡ä»¶å¹²æ‰ï¼Œä¹‹åä¼šå‘ç°æ²¡æœ‰ä¸Šè¿°çš„æ„å»º Locking å›¾çš„è¿‡ç¨‹ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å°†ä¸€ä¸ªç©ºå›¾ä½œä¸ºè¿”å›å€¼ã€‚

### è¦ç‚¹äºŒï¼šæ ¹æ® Target å¯¹ Podfile ä¸­çš„æè¿°æ¥å¯¹ spec è¿›è¡Œåˆ†ç»„

è¦ç‚¹ä¸€ä¸­æè¿°äº† `generate_version_locking_dependencies` ä¸­æ˜¯å¦‚ä½•åˆå§‹åŒ–ä¸€ä¸ªä¾èµ–å›¾ã€‚æˆ‘ä»¬è™½ç„¶æ‹¿åˆ°äº†ä¾èµ–å›¾ï¼Œä½†æ˜¯åœ¨æäº¤è‡³ *Molinillo* çš„ `Resolver` ä¹‹å‰è¿˜éœ€è¦æ‹¿åˆ°æ›´å¤šå…³äºä¾èµ–çš„æè¿°ã€‚ä¾‹å¦‚ï¼šSandbox æ²™ç›’ä¿¡æ¯ã€`Podfile` çš„è§£æç»“æœç­‰ç­‰ã€‚

{% highlight ruby %}
# file: lib/cocoapods/installer/analyzer.rb

# é€šè¿‡ Target å¯¹ Podfile è¿›è¡Œåˆ†ç»„
# ç”±äºæŸäº›ä¾èµ–å¯èƒ½å…·æœ‰å¤–éƒ¨æºï¼Œå› æ­¤ Resolver éœ€è¦è¯†åˆ« {Sandbox} å¹¶å»ä¸‹è½½ä»–ä»¬çš„ podspecã€‚è§£æå™¨éœ€è¦è¿™äº›æ¥åˆ†æä¾èµ–å…³ç³»
# å¢åŠ ã€åˆ é™¤æˆ–è€…ä¿®æ”¹çš„éœ€è¦åœ¨ä»²è£ä¹‹å‰ä» Sandbox ä¸­åˆ é™¤
# åœ¨ Update ä¸­ï¼Œresolve ä¼šè®¾ç½®æˆå§‹ç»ˆæ›´æ–°å¤–éƒ¨æº
#
def resolve_dependencies(locked_dependencies)
  # è·å–é‡å¤çš„ä¾èµ–
  duplicate_dependencies = podfile_dependencies.group_by(&:name).
    select { |_name, dependencies| dependencies.count > 1 }
  puts "duplicate_dependencies", duplicate_dependencies
  # å¦‚æœæœ‰é‡å¤å£°æ˜ä¾èµ–ï¼ŒæŠ›å‡ºè­¦å‘Š
  duplicate_dependencies.each do |name, dependencies|
    UI.warn "There are duplicate dependencies on `#{name}` in #{UI.path podfile.defined_in_file}:\n\n" \
     "- #{dependencies.map(&:to_s).join("\n- ")}"
  end

  resolver_specs_by_target = nil
  # è¿›å…¥ Resolving çš„æ—¥å¿—
  UI.section "Resolving dependencies of #{UI.path(podfile.defined_in_file) || 'Podfile'}" do
    # ä¼ å…¥ sandbox, podfile, locked_dependencies, sources ä»¥åŠæ˜¯å¦éœ€è¦æ›´æ–°çš„æ ‡è®°ï¼Œå®ä¾‹åŒ– Resolver
    resolver = Pod::Resolver.new(sandbox, podfile, locked_dependencies, sources, @specs_updated)
    # æ‹¿åˆ°  Molinillo çš„ä»²è£ç»“æœ
    resolver_specs_by_target = resolver.resolve
    # å–åˆ° Molinillo ä»²è£ç»“æœçš„ valuesï¼Œæ˜¯ä¸€ç»„ #<Pod::Resolver::ResolverSpecification> å¯¹è±¡
    # puts "resolver_specs_by_target.values", resolver_specs_by_target.values.flatten(1)[0].spec[]
    # ä»æ‰€æœ‰çš„ #<Pod::Resolver::ResolverSpecification> ä¸­å–å‡º
    resolver_specs_by_target.values.flatten(1).map(&:spec).each(&:validate_cocoapods_version)
  end

  # å°†å¤„ç†åçš„ resolver_specs_by_target è¿”å›
  resolver_specs_by_target
end
{% endhighlight %}

ä»¥ä¸Šä»£ç é€šè¿‡ç¯å¢ƒä¸­å·²ç» Lock ä½çš„ `locked_dependencies`ï¼Œå°†å…¶æ”¾å…¥ `Pod::Resolver` åšè¿›ä¸€æ­¥å¤„ç†çš„è¿‡ç¨‹ã€‚`locked_dependencies` å°±æ˜¯æˆ‘ä»¬å·²ç»åœ¨ `generate_version_locking_dependencies` é˜¶æ®µæ ¹æ® `Podfile.lock` å’Œ `Podfile` ç¡®å®šçš„é”å®š Podï¼Œå½“ç„¶å¦‚æœä¸å­˜åœ¨ `Podfile.lock` å¯èƒ½å°±æ˜¯ä¸ªç©ºæ•°ç»„ã€‚æ¥ç€æˆ‘ä»¬ç”¨ `sandbox`ï¼Œ`podfile`ï¼Œ`locked_dependencies`ï¼Œ`@specs_updated` æ„é€ ä¸€ä¸ª `Pod::Resolver` å®ä¾‹ï¼Œæ‰€æœ‰çš„å…¥å‚å«ä¹‰å’Œå®ä¾‹å†…å®¹æˆ‘å†™åœ¨ä¸‹é¢ï¼š

{% highlight json %}
[1] pry(#<Pod::Resolver>)> sandbox - æ²™ç›’ç›®å½•ï¼Œå…¶å®å°±æ˜¯é¡¹ç›®ä¸­çš„ Pods ç›®å½•
=> #<Pod::Sandbox> with root /Users/gua/Desktop/git/shawshank/Shawshank/Pods

[2] pry(#<Pod::Resolver>)> podfile - Pod::Podfile å®ä¾‹ï¼šè§£æçš„ Podfileï¼Œå¹¶ä¸”å·²ç»æ ¹æ® Target è¿›è¡Œä¾èµ–åˆ†ç»„ï¼Œè¿˜æœ‰å¾ˆå¤š Podfile ä¸­å®šåˆ¶çš„ Hook æ–¹æ³•
=> #<Pod::Podfile:0x00007f8e923d72f0
 @DEV_PATH="../../",
 @SWIFT_4_2_PODS=[],
 @current_target_definition=#<Pod::Podfile::TargetDefinition label=Pods>,
 @defined_in_file=#<Pathname:/Users/gua/Desktop/git/shawshank/Shawshank/Podfile>,
 @internal_hash={},
 @post_install_callback=#<Proc:0x00007f8e923e9590@/Users/gua/Desktop/git/shawshank/Shawshank/Podfile:76>,
 @root_target_definitions=[#<Pod::Podfile::TargetDefinition label=Pods>]>
 
[3] pry(#<Pod::Resolver>)> locked_dependencies - ä¸Šæ–‡åˆ†æçš„ Locked ä¾èµ–æ•°ç»„
=> Molinillo::DependencyGraph:[Molinillo::DependencyGraph::Vertex:Alamofire(<Pod::Dependency name=Alamofire requirements== 4.7.3, ~> 4.7, ~> 4.7.3 source=https://github.com/cocoapods/specs.git external_source=nil>), Molinillo::DependencyGraph::Vertex:AlamofireObjectMapper(<Pod::Dependency name=AlamofireObjectMapper requirements== 5.2.0, ~> 5.0 source=https://github.com/cocoapods/specs.git external_source=nil>), Molinillo::DependencyGraph::Vertex:FLEX(<Pod::Dependency name=FLEX requirements== 2.4.0, ~> 2.0 source=https://github.com/cocoapods/specs.git external_source=nil>), Molinillo::DependencyGraph::Vertex:GDMDebugger(<Pod::Dependency name=GDMDebugger requirements== 0.1.0 source=nil external_source={:branch=>"try_virtualized_tree", :git=>"git@github.com:Desgard/oversee.git"}>), Molinillo::DependencyGraph::Vertex:Hero(<Pod::Dependency name=Hero requirements== 1.4.0, ~> 1.4.0 source=https://github.com/cocoapods/specs.git external_source=nil>), Molinillo::DependencyGraph::Vertex:IQKeyboardManagerSwift(<Pod::Dependency name=IQKeyboardManagerSwift requirements== 6.2.1, ~> 6.2.0 source=https://github.com/cocoapods/specs.git external_source=nil>), Molinillo::DependencyGraph::Vertex:KVOController(<Pod::Dependency name=KVOController requirements== 1.2.0 source=https://github.com/cocoapods/specs.git external_source=nil>), Molinillo::DependencyGraph::Vertex:Nimble(<Pod::Dependency name=Nimble requirements== 8.0.1, ~> 8.0.0 source=https://github.com/cocoapods/specs.git external_source=nil>)}

[4] pry(#<Pod::Resolver>)> sources - Source æ•°ç»„ï¼Œå…¶å®æ˜¯å½“å‰å·¥ç¨‹ä½¿ç”¨åˆ°çš„ Source é›†åˆï¼Œä¸”æè¿°äº†åœ¨æœ¬åœ° Cache ä¸­çš„ pathï¼Œå³ `$HOME/.cocoapods/repos/` ç›®å½•ä¸‹çš„é‚£äº›ä»“åº“
=> [#<Pod::MasterSource name:master type:file system>]

[5] pry(#<Pod::Resolver>)> specs_updated - å‰æ–‡è®°å½•çš„éœ€è¦ update çš„ specs é›†åˆ
=> nil
{% endhighlight %}

![](/assets/images/blog/15536584001140/15626526744044.jpg)

åœ¨æ„å»ºå®Œ `Pod::Resolver` å®ä¾‹åï¼Œè°ƒç”¨å…¶ `resolve` æ–¹æ³•å°±å¯ä»¥è·å–åˆ°æ ¹æ® `Target` åˆ†ç»„çš„ä¾èµ–è§£æç»“æœã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒè¯•æ¥æŸ¥çœ‹è¿™ä¸ª *Molinillo* çš„ä»²è£ç»“æœ `resolver_specs_by_target`ã€‚

{% highlight ruby %}
# é€šè¿‡ keys è·å–åˆ°ä¸‹æ ‡ä¸º 1 çš„ Shawshank çš„ Target
[1] pry(#<Pod::Installer::Analyzer>)> ss_target = resolver_specs_by_target.keys[1]
=> #<Pod::Podfile::TargetDefinition label=Pods-Shawshank>

# å¯ä»¥è·å–åˆ°å¯¹åº” Target ä¸‹æ‰€æœ‰ Pod çš„è§£æç»“æœ
[2] pry(#<Pod::Installer::Analyzer>)> resolver_specs_by_target[ss_target]
=> [#<Pod::Resolver::ResolverSpecification:0x00007fec97262a10
  @source=#<Pod::MasterSource name:master type:file system>,
  @spec=#<Pod::Specification name="Alamofire">,
  @used_by_tests_only=false>,
 #<Pod::Resolver::ResolverSpecification:0x00007fec97262920
  @source=#<Pod::MasterSource name:master type:file system>,
  @spec=#<Pod::Specification name="AlamofireObjectMapper">,
  @used_by_tests_only=false>,
 #<Pod::Resolver::ResolverSpecification:0x00007fec97262808
  @source=#<Pod::MasterSource name:master type:file system>,
  @spec=#<Pod::Specification name="FLEX">,
  ...

# å–å‡º Alamofire çš„è§£æç»“æœå¯¹åº”çš„ Spec å®ä¾‹
[3] pry(#<Pod::Installer::Analyzer>)> resolver_specs_by_target[ss_target][0]
=> #<Pod::Resolver::ResolverSpecification:0x00007fec97262a10
 @source=#<Pod::MasterSource name:master type:file system>,
 @spec=#<Pod::Specification name="Alamofire">,
 
# ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å…¶æœ€ç»ˆçš„å†³è®®ç‰ˆæœ¬ 
[4] pry(#<Pod::Installer::Analyzer>)> resolver_specs_by_target[ss_target][0].spec.version
=> Gem::Version.new("4.7.3")
{% endhighlight %}

å¦å¤–æä¸€å¥ï¼Œ`validate_cocoapods_version` æ˜¯é’ˆå¯¹äºæ‰€æœ‰çš„ Spec è¿›è¡Œä¸€æ¬¡ CocoaPods ç‰ˆæœ¬çš„æ ¡éªŒï¼Œå¦‚æœ CocoaPods ç‰ˆæœ¬æœ‰è¯¯ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚

### è¦ç‚¹ä¸‰ï¼šè¿”å› AnalysisResult å®ä¾‹ï¼Œå¾—åˆ°ä»²è£ç»“æœ

åœ¨ä½¿ç”¨ `resolver_dependencies` å¾—åˆ° `resolver_specs_by_target` ä¹‹åï¼Œå…¶å®æ‰€æœ‰çš„ä»²è£è¿‡ç¨‹å·²ç»ç»“æŸã€‚ä½†æ˜¯ Pod ä¼šåšä¸€äº›å¯¹äº Spec çš„æ ¡éªŒå’Œåˆ†ç±»å˜æ¢ï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„ `Pod::Installer::Analyzer::AnalysisResult`ã€‚æˆ‘æŠŠ `analyze` æ–¹æ³•åœ¨è¿™ä¸ªé˜¶æ®µçš„ä»£ç æ‹¿åˆ°ä¸‹é¢ï¼Œå¹¶ä¸”æŠŠå…¶ä¸­çš„æ–¹æ³•å’Œå˜æ¢æ•°ç»„ä¸€ä¸€æ‹¿å‡ºæ¥åˆ†æä¸€ä¸‹ï¼š

{% highlight ruby %}
# æ ¡éªŒ platform åˆæ³•æ€§
validate_platforms(resolver_specs_by_target)
# Spec å¯¹å®ä¾‹æ•°ç»„
specifications  = generate_specifications(resolver_specs_by_target)
# åŸå·¥ç¨‹ä¸­å¯¹ Targets å®ä¾‹æ•°ç»„
targets         = generate_targets(resolver_specs_by_target, target_inspections)
# Pod Project çš„ Targets å®ä¾‹æ•°ç»„
pod_targets     = calculate_pod_targets(targets)
# Sandbox ä¸­ Spec æ•°ç»„ï¼Œå¯ç†è§£æˆä¸ Manifest çŠ¶æ€åŒæ­¥
sandbox_state   = generate_sandbox_state(specifications)
# æ ¹æ® target å¯¹ Spec åšåˆ†ç»„æ“ä½œ
specs_by_target = resolver_specs_by_target.each_with_object({}) do |rspecs_by_target, hash|
  hash[rspecs_by_target[0]] = rspecs_by_target[1].map(&:spec)
end
# æ ¹æ® sources å¯¹ Spec åšåˆ†ç»„æ“ä½œ
specs_by_source = Hash[resolver_specs_by_target.values.flatten(1).group_by(&:source).map do |source, specs|
  [source, specs.map(&:spec).uniq]
end]
sources.each { |s| specs_by_source[s] ||= [] }
# è¦ç‚¹ä¸‰ï¼šè¿”å›ä¸€ä¸ª AnalysisResult å®ä¾‹ï¼Œå¾—åˆ°æœ€ç»ˆçš„ä»²è£ç»“æœ
@result = AnalysisResult.new(podfile_state, specs_by_target, specs_by_source, specifications, sandbox_state,
                              targets, pod_targets, @podfile_dependency_cache)
{% endhighlight %}

ä¸‹é¢æ˜¯æ¯ä¸ªæ“ä½œçš„ç¤ºä¾‹è¾“å‡º Log ä»¥åŠä¸€äº›ç±»å‹è§£æï¼š

{% highlight ruby %}
# æ‰“å¹³çš„ spec å®ä¾‹
[3] pry(#<Pod::Installer::Analyzer>)> specifications
=> [#<Pod::Specification name="Alamofire">,
 #<Pod::Specification name="AlamofireObjectMapper">,
 #<Pod::Specification name="FLEX">,
 #<Pod::Specification name="FMDB">,
 #<Pod::Specification name="FMDB/standard">,
 #<Pod::Specification name="GCDWebServer">,
 #<Pod::Specification name="GCDWebServer/Core">,
 #<Pod::Specification name="GDMDebugger">,
 #<Pod::Specification name="Hero">,
 #<Pod::Specification name="IQKeyboardManagerSwift">,
 #<Pod::Specification name="KVOController">,
 #<Pod::Specification name="ObjectMapper">,
 #<Pod::Specification name="Reveal-SDK">,
 #<Pod::Specification name="SQLiteRepairKit">,
 #<Pod::Specification name="SSZipArchive">,
 #<Pod::Specification name="SnapKit">,
 #<Pod::Specification name="SwiftMessages">,
 #<Pod::Specification name="SwiftMessages/App">,
 #<Pod::Specification name="SwifterSwift">,
 #<Pod::Specification name="SwifterSwift/AppKit">,
 #<Pod::Specification name="SwifterSwift/CoreGraphics">,
 #<Pod::Specification name="SwifterSwift/CoreLocation">,
 #<Pod::Specification name="SwifterSwift/Dispatch">,
 #<Pod::Specification name="SwifterSwift/Foundation">,
 #<Pod::Specification name="SwifterSwift/MapKit">,
 #<Pod::Specification name="SwifterSwift/SpriteKit">,
 #<Pod::Specification name="SwifterSwift/SwiftStdlib">,
 #<Pod::Specification name="SwifterSwift/UIKit">,
 #<Pod::Specification name="SwiftyUserDefaults">,
 #<Pod::Specification name="WCDB.swift">,
 #<Pod::Specification name="WCDBOptimizedSQLCipher">,
 #<Pod::Specification name="pop">,
 #<Pod::Specification name="Nimble">]
 
# æ‰“å¹³çš„ targets æ•°ç»„
[5] pry(#<Pod::Installer::Analyzer>)> targets 
=> [<Pod::AggregateTarget name=Pods-Shawshank >, <Pod::AggregateTarget name=Pods-ShawshankTunnel >, <Pod::AggregateTarget name=Pods-ShawshankTests >]

# æ‰€æœ‰ Pod Targets å®ä¾‹æ•°ç»„
[6] pry(#<Pod::Installer::Analyzer>)> pod_targets
=> [<Pod::PodTarget name=Alamofire >,
 <Pod::PodTarget name=AlamofireObjectMapper >,
 <Pod::PodTarget name=FLEX >,
 <Pod::PodTarget name=FMDB >,
 <Pod::PodTarget name=GCDWebServer >,
 <Pod::PodTarget name=GDMDebugger >,
 <Pod::PodTarget name=Hero >,
 <Pod::PodTarget name=IQKeyboardManagerSwift >,
 <Pod::PodTarget name=KVOController >,
 <Pod::PodTarget name=ObjectMapper >,
 <Pod::PodTarget name=Reveal-SDK >,
 <Pod::PodTarget name=SQLiteRepairKit >,
 <Pod::PodTarget name=SSZipArchive >,
 <Pod::PodTarget name=SnapKit >,
 <Pod::PodTarget name=SwiftMessages >,
 <Pod::PodTarget name=SwifterSwift >,
 <Pod::PodTarget name=SwiftyUserDefaults >,
 <Pod::PodTarget name=WCDB.swift >,
 <Pod::PodTarget name=WCDBOptimizedSQLCipher >,
 <Pod::PodTarget name=pop >,
 <Pod::PodTarget name=Nimble >]
 
# æ²™ç›’ sandbox state
[7] pry(#<Pod::Installer::Analyzer>)> sandbox_state
=> #<Pod::Installer::Analyzer::SpecsState:0x00007ff0011b31b0
 @added=#<Set: {}>,
 @changed=#<Set: {}>,
 @deleted=#<Set: {}>,
 @unchanged=
  #<Set: {"Alamofire",
   "AlamofireObjectMapper",
   "FLEX",
   "FMDB",
   "GCDWebServer",
   "GDMDebugger",
   "Hero",
   "IQKeyboardManagerSwift",
   "KVOController",
   "Nimble",
   "ObjectMapper",
   "Reveal-SDK",
   "SQLiteRepairKit",
   "SSZipArchive",
   "SnapKit",
   "SwiftMessages",
   "SwifterSwift",
   "SwiftyUserDefaults",
   "WCDB.swift",
   "WCDBOptimizedSQLCipher",
   "pop"}>>

# æ ¹æ® Target å¯¹ Spec åšåˆ†ç±»
[9] pry(#<Pod::Installer::Analyzer>)> specs_by_target
=> {#<Pod::Podfile::TargetDefinition label=Pods>=>[],
 #<Pod::Podfile::TargetDefinition label=Pods-Shawshank>=>
  [#<Pod::Specification name="Alamofire">,
   #<Pod::Specification name="AlamofireObjectMapper">,
   #<Pod::Specification name="FLEX">,
   #<Pod::Specification name="FMDB">,
   #<Pod::Specification name="FMDB/standard">,
   #<Pod::Specification name="GCDWebServer">,
   #<Pod::Specification name="GCDWebServer/Core">,
   #<Pod::Specification name="GDMDebugger">,
   #<Pod::Specification name="Hero">,
   #<Pod::Specification name="IQKeyboardManagerSwift">,
   #<Pod::Specification name="KVOController">,
   #<Pod::Specification name="ObjectMapper">,
   #<Pod::Specification name="Reveal-SDK">,
   #<Pod::Specification name="SQLiteRepairKit">,
   #<Pod::Specification name="SSZipArchive">,
   #<Pod::Specification name="SnapKit">,
   #<Pod::Specification name="SwiftMessages">,
   #<Pod::Specification name="SwiftMessages/App">,
   #<Pod::Specification name="SwifterSwift">,
   #<Pod::Specification name="SwifterSwift/AppKit">,
   #<Pod::Specification name="SwifterSwift/CoreGraphics">,
   #<Pod::Specification name="SwifterSwift/CoreLocation">,
   #<Pod::Specification name="SwifterSwift/Dispatch">,
   #<Pod::Specification name="SwifterSwift/Foundation">,
   #<Pod::Specification name="SwifterSwift/MapKit">,
   #<Pod::Specification name="SwifterSwift/SpriteKit">,
   #<Pod::Specification name="SwifterSwift/SwiftStdlib">,
   #<Pod::Specification name="SwifterSwift/UIKit">,
   #<Pod::Specification name="SwiftyUserDefaults">,
   #<Pod::Specification name="WCDB.swift">,
   #<Pod::Specification name="WCDBOptimizedSQLCipher">,
   #<Pod::Specification name="pop">],
 #<Pod::Podfile::TargetDefinition label=Pods-ShawshankTunnel>=>[],
 #<Pod::Podfile::TargetDefinition label=Pods-ShawshankTests>=>[#<Pod::Specification name="Nimble">]}

# æ ¹æ® Source å¯¹ Spec è¿›è¡Œåˆ†ç±»
[10] pry(#<Pod::Installer::Analyzer>)> specs_by_source
=> {#<Pod::MasterSource name:master type:file system>=>
  [#<Pod::Specification name="Alamofire">,
   #<Pod::Specification name="AlamofireObjectMapper">,
   #<Pod::Specification name="FLEX">,
   #<Pod::Specification name="FMDB">,
   #<Pod::Specification name="FMDB/standard">,
   #<Pod::Specification name="GCDWebServer">,
   #<Pod::Specification name="GCDWebServer/Core">,
   #<Pod::Specification name="Hero">,
   #<Pod::Specification name="IQKeyboardManagerSwift">,
   #<Pod::Specification name="KVOController">,
   #<Pod::Specification name="ObjectMapper">,
   #<Pod::Specification name="SQLiteRepairKit">,
   #<Pod::Specification name="SSZipArchive">,
   #<Pod::Specification name="SnapKit">,
   #<Pod::Specification name="SwiftMessages">,
   #<Pod::Specification name="SwiftMessages/App">,
   #<Pod::Specification name="SwifterSwift">,
   #<Pod::Specification name="SwifterSwift/AppKit">,
   #<Pod::Specification name="SwifterSwift/CoreGraphics">,
   #<Pod::Specification name="SwifterSwift/CoreLocation">,
   #<Pod::Specification name="SwifterSwift/Dispatch">,
   #<Pod::Specification name="SwifterSwift/Foundation">,
   #<Pod::Specification name="SwifterSwift/MapKit">,
   #<Pod::Specification name="SwifterSwift/SpriteKit">,
   #<Pod::Specification name="SwifterSwift/SwiftStdlib">,
   #<Pod::Specification name="SwifterSwift/UIKit">,
   #<Pod::Specification name="SwiftyUserDefaults">,
   #<Pod::Specification name="WCDB.swift">,
   #<Pod::Specification name="WCDBOptimizedSQLCipher">,
   #<Pod::Specification name="pop">,
   #<Pod::Specification name="Nimble">],
 false=>[#<Pod::Specification name="GDMDebugger">, #<Pod::Specification name="Reveal-SDK">]}
{% endhighlight %}

æˆ‘ä»¬æ‹¿åˆ°äº† `podfile_state`ï¼Œ`specs_by_target`ï¼Œ`specs_by_source`ï¼Œ`specifications`ï¼Œ`sandbox_state`ï¼Œ`targets`ï¼Œ`pod_targets` è¿™å…­ä¸ªæ ¹æ® `resolver` å˜æ¢çš„æ•°ç»„åï¼Œå°±å¯ä»¥å®ä¾‹åŒ– `AnalysisResult` å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä¹Ÿå°±æ˜¯ `analysis` å¯¹å¤–æš´éœ²çš„æœ€ç»ˆç»“æœï¼Œä¹Ÿæ˜¯ CocoaPods åœ¨ Install åé¢è¿‡ç¨‹ä¸­ä¾èµ–çš„è§£æä¿¡æ¯ç»“æœã€‚

### è¿‡ç¨‹æ€»ç»“

åœ¨ `Resolver` è§£æåˆå§‹æ€çš„ Analysis è¿‡ç¨‹ä¸­ï¼ŒCocoaPods é€šè¿‡å¯¹ `Podfile` å’Œ `Podfile.lock` çš„è§£æï¼Œæå–å‡ºé”å®šçš„ Podsï¼Œå¹¶å°†å…¶ä¸ `Podfile` å®ä¾‹ä¿¡æ¯å…±åŒäº¤äºˆ *Molinillo* ç®—æ³•åˆ†æï¼Œå¹¶åé¦ˆä¸€ä¸ªæ ¹æ® Target åˆ†ç±»çš„ Spec Hashã€‚ä¹‹åé€šè¿‡å„ç§çš„å‡½æ•°å¼å˜æ¢ï¼Œå®ä¾‹åŒ–å‡º `AnalysisResult` å¯¹è±¡ï¼Œä¾›åç»­è¿‡ç¨‹ä½¿ç”¨ã€‚

![](/assets/images/blog/15536584001140/15626734735603.jpg)

## æ£€æµ‹æ˜¯å¦æœ‰æ— æ•ˆçš„ Configurations

åœ¨å®Œæˆäº†ä¾èµ–ä»²è£ï¼Œåé¢åªéœ€è¦åšä¸€äº›æ”¶å°¾å·¥ä½œã€‚CocoaPods åœ¨è¿™ä¸ªæµç¨‹ä¸­é¦–å…ˆä¼šæ£€æµ‹ `Podfile` ä¸­çš„ Configurations æ˜¯å¦æœ‰æ•ˆã€‚

{% highlight ruby %}
def validate_build_configurations
  # Podfile ä¸­è§£æå‡ºéœ€è¦å°† Pod å®‰è£…çš„æ‰€æœ‰ Configuration
  whitelisted_configs = pod_targets.
    flat_map(&:target_definitions).
    flat_map(&:all_whitelisted_configurations).
    map(&:downcase).
    uniq
  # å·¥ç¨‹ä¸­æ‰€æœ‰ Configurations
  all_user_configurations = analysis_result.all_user_build_configurations.keys.map(&:downcase)

  # å£°æ˜é›†åˆä¸å·¥ç¨‹è§£æé›†åˆå–å·®é›†ï¼Œæ­£å¸¸æƒ…å†µä¸‹å£°æ˜é›†åˆåº”è¯¥æ˜¯å·¥ç¨‹è§£æé›†åˆçš„å­é›†ï¼Œæ‰€ä»¥å·®é›†åº”è¯¥ä¸ºç©º
  remainder = whitelisted_configs - all_user_configurations
  # ä¸ä¸ºç©ºåˆ™è¯´æ˜ Podfile ä¸­å£°æ˜äº†éæ³•çš„ Configurationï¼ŒæŠ›å‡ºå¼‚å¸¸
  unless remainder.empty?
    raise Informative,
          "Unknown #{'configuration'.pluralize(remainder.size)} whitelisted: #{remainder.sort.to_sentence}. " \
          "CocoaPods found #{all_user_configurations.sort.to_sentence}, did you mean one of these?"
  end
end
{% endhighlight %}

## æ¸…ç† Sandbox æ²™ç›’ç›®å½•

ä¾èµ–è§£æå·²ç»è·å¾—äº†ä»²è£ç»“æœ `analysis_result`ï¼Œåç»­æˆ‘ä»¬éœ€è¦ä¸º Sandbox æ²™ç›’ç›®å½•ï¼ˆ`Pods/`ï¼‰åˆ›é€ åˆå§‹åŒ–ç¯å¢ƒã€‚
 
{% highlight ruby %}
def clean_sandbox
  # åˆ é™¤ public header ç›®å½•
  sandbox.public_headers.implode!
  # æ‰¾åˆ°æ‰€æœ‰ target çš„ Target Support Files ç›®å½•
  target_support_dirs = sandbox.target_support_files_root.children.select(&:directory?)
  # éå†æ‰€æœ‰çš„ pod_targets
  pod_targets.each do |pod_target|
    # æ¸…ç†å¯¹åº”çš„ build headers
    pod_target.build_headers.implode!
    # åˆ é™¤å¯¹åº”çš„ support files ç›®å½•
    target_support_dirs.delete(pod_target.support_files_dir)
  end

  # éå†æ‰€æœ‰çš„ target
  aggregate_targets.each do |aggregate_target|
    # åˆ é™¤å¯¹åº”çš„ support files ç›®å½•
    target_support_dirs.delete(aggregate_target.support_files_dir)
  end

  # å°†è¿™äº› target support æ ¹ç›®å½•ä¹Ÿä¸€åŒå¹²æ‰
  target_support_dirs.each { |dir| FileUtils.rm_rf(dir) }

  # æ¸…ç†å·²ç»åˆ é™¤çš„ Pod çš„æ²™ç›’ç›®å½•
  unless sandbox_state.deleted.empty?
    # è¾“å‡º log æ ¼å¼åŒ–
    title_options = { :verbose_prefix => '-> '.red }
    # æ ¹æ® pod_name åŒ¹é…ï¼Œæ¸…ç†æ²™ç›’
    sandbox_state.deleted.each do |pod_name|
      UI.titled_section("Removing #{pod_name}".red, title_options) do
        sandbox.clean_pod(pod_name)
      end
    end
  end
end
{% endhighlight %}

## `deployment` æ¨¡å¼ä¸‹çš„ä¸€äº›å¼ºæ ¡éªŒ

å¦å¤– `Resolver` é˜¶æ®µï¼Œç”±äºæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¾èµ–ç‰ˆæœ¬ä»²è£ï¼Œæ‰€ä»¥æˆ‘ä»¬å·²ç»è·å–åˆ°äº†æ‰€æœ‰çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¿™æ ·åœ¨ `deployment` æ¨¡å¼ä¸‹å°±å¯ä»¥å¯¹ `Podfile.lock` æ–‡ä»¶åšå¼ºæ ¡éªŒã€‚

{% highlight ruby %}
def verify_no_podfile_changes!
  # å¦‚æœæ²¡æœ‰ podfile_needs_install æ ‡è®°åˆ™è·³è¿‡
  # ç”¨æ¥æ¯”å¯¹ podfile å’Œ lock çš„ç‰ˆæœ¬å·®å¼‚
  return unless analysis_result.podfile_needs_install?

  changed_state = analysis_result.podfile_state.to_s(:states => %i(added deleted changed))
  raise Informative, "There were changes to the podfile in deployment mode:\n#{changed_state}"
end

def verify_no_lockfile_changes!
  # è·å–åˆ°æ–°ç”Ÿæˆçš„ Lockfile
  new_lockfile = generate_lockfile
  return if new_lockfile == lockfile

  # å¦‚æœä¸åŒçš„è¯åˆ™ä¸æ»¡è¶³ deplayment æ ‡å¿—ï¼ŒLog ä¸­è¾“å‡º Diff å·®å¼‚
  diff = Xcodeproj::Differ.hash_diff(lockfile.to_hash, new_lockfile.to_hash, :key_1 => 'Old Lockfile', :key_2 => 'New Lockfile')
  pretty_diff = YAMLHelper.convert_hash(diff, Lockfile::HASH_KEY_ORDER, "\n\n")
  pretty_diff.gsub!(':diff:', 'diff:'.yellow)

  raise Informative, "There were changes to the lockfile in deployment mode:\n#{pretty_diff}"
end
{% endhighlight %}

## æ‹“å±•æ€è€ƒ

çœ‹äº†è¿™éƒ¨åˆ†çš„ä»£ç ï¼Œæˆ‘ä»¬æœ‰ä»€ä¹ˆå¯å‘ï¼Ÿæˆ–è€…è¯´æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„æƒ³æ³•å‘¢ï¼Ÿè¿™é‡Œç»“åˆä¸šåŠ¡æ€»ç»“äº†ä¸€ä¸‹å‡ ä¸ªæŠ€å·§ã€‚

### 1. å¿«é€Ÿç”Ÿæˆ Lockfile æ–‡ä»¶

åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œä¸€ä¸ª Pod å¯èƒ½ä¼šæœ‰ä¸Šç™¾ä¸ªï¼Œåœ¨ä¸€æ¬¡å®Œæ•´çš„ `pod install` æœ€å°‘éœ€è¦æ•°åˆ†é’Ÿä»¥ä¸Šã€‚æœ‰æ—¶å€™æˆ‘ä»¬åœ¨ merge ä»£ç æ—¶ï¼Œåœ¨ `Podfile` å’Œ `Podfile.lock` è§£å®Œå†²çªåï¼Œä¸ºäº†ç¡®ä¿ `Podfile.lock` æ— è¯¯ï¼Œä¼šå†æ¬¡è¿›è¡Œä¸€æ¬¡ `pod install` ç”Ÿæˆä¸€æ¬¡ `Podfile.lock`ã€‚

ä½†å…¶å®ï¼Œ`Resolve` è¿‡ç¨‹å·²ç»åˆ†æå‡ºäº†ä¸€ä¸ª `Podfile.lock` ä¸­çš„æ‰€æœ‰å¾…è®°å½•çš„å†…å®¹ï¼Œæˆ‘ä»¬æ‹¿åˆ° `analysis` å…¶å®å°±å¯ä»¥ç›´æ¥å†™æ–‡ä»¶äº†ã€‚è€Œä¸€æ¬¡ `pod install` æ›´å¤šçš„æ—¶é—´æ˜¯åœ¨ `download` é˜¶æ®µï¼Œä½†æ˜¯è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åªéœ€ä¸€ä¸ªä»½æ›´æ–°åçš„ `Podfile.lock` æ–‡ä»¶å³å¯ã€‚æ ¹æ®ä»¥ä¸Šéœ€æ±‚ä»¥åŠå¯¹ `resolve` é˜¶æ®µçš„äº†è§£ï¼Œå¯ä»¥åˆ¶ä½œä¸€ä¸ª `pod lock` çš„å‘½ä»¤æ¥å¿«é€Ÿç”Ÿæˆ `Podfile.lock` æ–‡ä»¶ã€‚

{% highlight ruby %}
module Pod
  class Command
    class Lock < Command
      include RepoUpdate
      include ProjectDirectory
      self.summary = "Generate the `Podfile.lock` files not to install."
      self.description = self.summary

      def self.options
        [
            ['--repo-update', 'Force running `pod repo update` before generate the Podfile.lock'],
        ].concat(super).reject { |(name, _)| name == '--no-repo-update' }
      end

      def initialize(argv)
        super
      end

      def run
        Dir.chdir(config.installation_root) do
          verify_podfile_exists!
          installer = installer_for_config
          installer.repo_update = !@repo_update.nil?
          installer.update = false
          installer.quick_generate_lockfile!
        end
      end
    end
  end

  # Add some function to Installer
  class Installer
    def quick_generate_lockfile!
      # åˆå§‹åŒ– sandbox ç¯å¢ƒ
      quick_prepare_env
      # å®Œæˆ resolve çš„ä»²è£ï¼Œæ‹¿åˆ° analysis
      resolve_dependencies
      # ç›´æ¥æ‰§è¡Œå†™ lock åˆ°æœ¬åœ°æ–‡ä»¶æ“ä½œ
      quick_write_lockfiles
    end

    def quick_prepare_env
      if Dir.pwd.start_with?(sandbox.root.to_path)
        message = 'Command should be run from a directory outside Pods directory.'
        message << "\n\n\tCurrent directory is #{UI.path(Pathname.pwd)}\n"
        raise Informative, message
      end
      UI.message 'Prepareing' do
        # æ£€æµ‹æ²™ç›’ç‰ˆæœ¬
        deintegrate_if_different_major_version
        sandbox.quick_prepare
        ensure_plugins_are_installed!
        run_plugins_pre_install_hooks
      end
    end

    # Writes the Podfile lock file, and to except for sandbox `Manifest.lock`
    #
    # @return [void]
    #
    def quick_write_lockfiles
      @lockfile = generate_lockfile
      UI.message "- Quickly Writing Lockfile in #{UI.path config.lockfile_path}" do
        @lockfile.write_to_disk(config.lockfile_path)
      end
    end
  end

  class Sandbox
    def quick_prepare
      FileUtils.mkdir_p(headers_root)
      FileUtils.mkdir_p(sources_root)
      FileUtils.mkdir_p(specifications_root)
      FileUtils.mkdir_p(target_support_files_root)
    end
  end
end
{% endhighlight %}

å¦‚æ­¤ï¼Œæ‰§è¡Œ `pod lock` å°±å¯ä»¥è¿…é€Ÿå®Œæˆ `Podfile.lock` çš„å†™å…¥ï¼Œå¹¶ä¸”å…¶ä¾èµ–ä»²è£çš„å…¨è¿‡ç¨‹ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚è¿™ä¸ªå‘½ä»¤é™¤äº†åœ¨æœ¬åœ°å¼€å‘å¯ä»¥è¿…é€Ÿç”Ÿæˆ Lock æ–‡ä»¶ä»¥å¤–ï¼Œåœ¨æŠ–éŸ³ iOS çš„ç ”å‘æµç¨‹ä¸­ï¼Œè¿˜ä¼šåœ¨ CI è¿‡ç¨‹æœ€åçš„é›†æˆé˜¶æ®µç”¨ä»¥åŒæ­¥ `Podfile.lock` ä¸ºæœ€æ–°æ€ï¼Œè¿™æ ·ä¹Ÿè§£å†³äº†ç ”å‘åŒå­¦åœ¨æäº¤ MR çš„æ—¶å€™ï¼Œä¸æ˜ç¡®æ˜¯å¦è¦æäº¤ `Podfile.lock` çš„é—®é¢˜ã€‚

### 2. è°ƒè¯• `@activated` ä»²è£ç»“æœæ•°ç»„

åœ¨æ’æŸ¥ Pod ä¾èµ–çš„æ¿€æ´»ç‰ˆæœ¬æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥æ˜ Pod å„ä¸ªç‰ˆæœ¬çš„é€’å½’ç»“æœæ¬¡åºï¼Œé€šå¸¸æ–¹æ³•æ˜¯æˆ‘ä»¬è®² `MOLINILLO_DEBUG` èµ‹æœ‰æ•ˆå€¼ï¼Œæ¿€æ´»å…¶ Debug æ¨¡å¼æ‰“å°å‡ºæ›´å¤šçš„ Logã€‚

{% highlight shell %}
export MOLINILLO_DEBUG=1
{% endhighlight %}

ä½†æ˜¯ `Molinillo` ä»“åº“çš„ Debug Log å®åœ¨æ˜¯åäººç±»ï¼š

{% highlight ruby %}
Resolving dependencies of `Podfile`
:   0: Starting resolution (2019-07-10 19:08:53 +0800)
:   0: User-requested dependencies: [<Pod::Dependency name=pop requirements=~> 1.0 source=nil external_source=nil>, <Pod::Dependency name=KVOController requirements=>= 0 source=nil external_source=nil>, <Pod::Dependency name=IQKeyboardManagerSwift requirements=~> 6.2.0 source=nil external_source=nil>, <Pod::Dependency name=SwiftMessages requirements=~> 6.0.2 source=nil external_source=nil>, <Pod::Dependency name=ESTabBarController-swift requirements=>= 0 source=nil external_source=nil>, <Pod::Dependency name=DeviceKit requirements=~> 2.0 source=nil external_source=nil>, <Pod::Dependency name=SwifterSwift requirements=~> 5.0.0 source=nil external_source=nil>, <Pod::Dependency name=Alamofire requirements=~> 4.7.3 source=nil external_source=nil>, <Pod::Dependency name=ObjectMapper requirements=~> 3.1 source=nil external_source=nil>, <Pod::Dependency name=AlamofireObjectMapper requirements=~> 5.0 source=nil external_source=nil>, <Pod::Dependency name=SDWebImage requirements=~> 4.4.6 source=nil external_source=nil>, <Pod::Dependency name=SnapKit requirements=~> 5.0.0 source=nil external_source=nil>, <Pod::Dependency name=CocoaLumberjack/Swift requirements=>= 0 source=nil external_source=nil>, <Pod::Dependency name=SwiftyUserDefaults requirements=>= 0 source=nil external_source=nil>, <Pod::Dependency name=Reveal-SDK requirements=>= 0 source=nil external_source={:path=>"Reveal"}>, <Pod::Dependency name=FLEX requirements=~> 2.0 source=nil external_source=nil>]
:   0: Creating possibility state for Reveal-SDK (from `Reveal`) (1 remaining)
:   1: Attempting to activate [Reveal-SDK (4)]
:   1: Activated Reveal-SDK at [Reveal-SDK (4)]
:   1: Requiring nested dependencies ()
:   1: Creating possibility state for KVOController (1 remaining)
:   2: Attempting to activate [KVOController (1.2.0)]
:   2: Activated KVOController at [KVOController (1.2.0)]
:   2: Requiring nested dependencies ()
:   2: Creating possibility state for IQKeyboardManagerSwift (~> 6.2.0) (1 remaining)
:   3: Attempting to activate [IQKeyboardManagerSwift (6.2.1)]
:   3: Activated IQKeyboardManagerSwift at [IQKeyboardManagerSwift (6.2.1)]
:   3: Requiring nested dependencies ()
:   3: Creating possibility state for SwiftMessages (~> 6.0.2) (1 remaining)
:   4: Attempting to activate [SwiftMessages (6.0.2)]
:   4: Activated SwiftMessages at [SwiftMessages (6.0.2)]
:   4: Requiring nested dependencies (SwiftMessages/App (= 6.0.2))
:   4: Creating possibility state for SwiftMessages/App (= 6.0.2) (1 remaining)
:   5: Attempting to activate [SwiftMessages/App (6.0.2)]
:   5: Activated SwiftMessages/App at [SwiftMessages/App (6.0.2)]
...
{% endhighlight %}

è¿™æ—¶å€™æˆ‘ä»¬é€šè¿‡ `pry` çš„ `binding` æ–¹å¼ï¼Œåœ¨ `lib/cocoapods/resolver.rb` ä¸­æ’å…¥æ–­ç‚¹ï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å‡º `self` å³å¯çœ‹åˆ°è§£æç»“æœä»¥åŠæ‰€æœ‰æ¿€æ´»çš„ Podã€‚å¯¹äºéœ€è¦æŸ¥çœ‹ç°è±¡çš„æˆ‘ä»¬æ¥è¯´ï¼Œåªéœ€è¦ç»“æœå°±å¥½äº†~

![](/assets/images/blog/15536584001140/15627662815778.jpg)


## æ€»ç»“

äº†è§£ `Resolve` è¿‡ç¨‹å¯ä»¥ç†æ¸… *CocoaPods* åœ¨ä¾èµ–è§£æçš„å…¥å£å’Œè§£æå®Œæ¯•ä¹‹åçš„å…·ä½“æµç¨‹ã€‚æŒæ¡è¿™ä¸€éƒ¨åˆ†çš„ç»†èŠ‚å¯ä»¥ä½¿å¾—ç»„ä»¶ç‰ˆæœ¬å¤„ç†çš„è¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼Œæ–¹ä¾¿æ’æŸ¥ *CocoaPods* åœ¨è§£æä¾èµ–å‰åçš„ç¯å¢ƒé—®é¢˜ä»¥åŠåœ¨ä¼ å…¥ç»™ *Molinillo* çš„å…¥å‚æ˜¯å¦æœ‰è¯¯ã€‚

åç»­ä¼šå…·ä½“æ·±å…¥åˆ° *Molinillo* å›¾ç®—æ³•ä¸­å»è®¤è¯†ä»²è£æµç¨‹ï¼Œå°½è¯·æœŸå¾…~



